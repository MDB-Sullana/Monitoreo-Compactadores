<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Chatbot Bellavista</title>
<style>
  body {
    font-family: Arial, sans-serif;
  }
  #chatbox {
    width: 350px;
    height: 450px;
    border: 1px solid #ccc;
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  #messages {
    flex: 1;
    overflow-y: auto;
    border: 1px solid #eee;
    padding: 8px;
    background: #fafafa;
  }
  #inputArea {
    display: flex;
    gap: 6px;
  }
  input {
    flex: 1;
    padding: 8px;
  }
  button {
    padding: 8px 12px;
    background: #1e3a8a;
    color: white;
    border: none;
    cursor: pointer;
  }
</style>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
(function() {
  emailjs.init("_Iq2cEVId5yGaT-WvZMxE");
})();
</script>

</head>
<body>

<div id="chatbox">
  <h3>Chat Municipalidad Bellavista</h3>
  <div id="messages"></div>

  <div id="inputArea">
    <input id="userInput" type="text" placeholder="Escribe aqu√≠...">
    <button onclick="sendMessage()">Enviar</button>
  </div>
</div>

<script>
  const messages = document.getElementById("messages");

  function addMessage(text, sender = "bot") {
    const p = document.createElement("p");
    p.innerHTML = `<strong>${sender === "bot" ? "ü§ñ" : "üßë‚Äçüíº"}:</strong> ${text}`;
    messages.appendChild(p);
    messages.scrollTop = messages.scrollHeight;
  }

  // MENSAJE INICIAL
  addMessage("Estimado vecino, contribuye a mantener una ciudad limpia.<br>Por favor ind√≠came tu direcci√≥n y la incidencia (residuos no recogidos).");

  function sendMessage() {
    const input = document.getElementById("userInput");
    const text = input.value.trim();

    if (!text) return;

    addMessage(text, "user");
    input.value = "";

    procesarMensaje(text);
  }

  function procesarMensaje(text) {
    addMessage("Gracias, estoy registrando tu reporte...");

    enviarCorreo(text)
      .then(() => {
        addMessage("Tu reporte fue enviado correctamente ‚úîÔ∏è");
      })
      .catch((err) => {
        addMessage("Hubo un error al enviar el reporte ‚ùå");
        console.error(err);
      });
  }

  function enviarCorreo(mensaje) {
    return emailjs.send(
      "service_6n1vp4m",
      "template_7yj72fo",
      {
        mensaje: mensaje,
        correo: "kmauriciomaldonado@mdbellavista.gob.pe"
      }
    );
  }
</script>

</body>
</html>
