<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monitoreo Ciudadano - Bellavista</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script>
        emailjs.init({ publicKey: "IGGKWnrPTdwnN39yS" });
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background: #f3f4f6; }

        #chatbot-button {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: #1e3a8a;
            color: white;
            width: 65px;
            height: 65px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            z-index: 9999;
        }

        #chatbot-window {
            width: 330px;
            height: 480px;
            background: white;
            position: fixed;
            bottom: 100px;
            right: 25px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.25);
            display: none;
            flex-direction: column;
            overflow: hidden;
            z-index: 9999;
        }

        #chatbot-messages {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            background: #e5e7eb;
        }

        .msg {
            margin-bottom: 10px;
            padding: 10px 14px;
            max-width: 80%;
            border-radius: 12px;
            font-size: 14px;
        }

        .bot { background: white; }
        .user { background: #1e3a8a; color: white; margin-left: auto; }

        #chat-input-box {
            display: flex;
            padding: 8px;
            border-top: 1px solid #ddd;
        }

        #user-input {
            flex: 1;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #ccc;
        }

        #send-btn {
            margin-left: 6px;
            background: #1e3a8a;
            color: white;
            padding: 8px 14px;
            border-radius: 8px;
        }
    </style>
</head>

<body>

<header class="bg-blue-900 text-white text-center py-4 shadow-xl">
    <h1 class="text-2xl font-extrabold">
        Monitoreo Ciudadano de Camiones Compactadores
    </h1>
    <p class="text-blue-200 text-sm">
        Municipalidad Distrital de Bellavista
    </p>
</header>

<main class="p-4">

    <!-- BANDA TURNO MAPA -->
    <div id="turno-banner" class="hidden mb-3">
        <div id="turno-bg"
            class="w-full rounded-xl px-6 py-3 text-white text-center font-semibold shadow-lg">
            <span id="turno-text"></span>
        </div>
    </div>

    <!-- MAPA -->
    <div id="map-section" class="hidden">
        <iframe 
            src="https://monitoreo.gpseyes.pe/sharing/f26738032cc992ea790a7a6d80f5b066"
            class="w-full h-[80vh] rounded-xl shadow-xl">
        </iframe>
    </div>

    <!-- COCHERA -->
    <div id="cochera-section" class="hidden flex items-center justify-center h-[80vh]">
        <div class="bg-blue-900 text-white rounded-3xl shadow-2xl p-10 text-center max-w-3xl">
            <h2 class="text-3xl font-extrabold mb-4">
                CAMIONES EN COCHERA
                <span class="block text-blue-200">Servicio no disponible</span>
            </h2>
            <p class="text-lg mb-2">
                El servicio de recolecciÃ³n no se encuentra operativo en este horario.
            </p>
            <p class="text-blue-300 text-sm">
                Horario de monitoreo: 5:00 a.m. â€“ 1:00 p.m. y 2:00 p.m. â€“ 9:30 p.m.
            </p>
        </div>
    </div>

</main>

<!-- BOTÃ“N CHAT -->
<div id="chatbot-button">ðŸ’¬</div>

<!-- CHAT -->
<div id="chatbot-window">
    <div id="chatbot-messages"></div>
    <div id="chat-input-box">
        <input id="user-input" placeholder="Escribe aquÃ­..." />
        <button id="send-btn">Enviar</button>
    </div>
</div>

<script>
    function two(n){ return String(n).padStart(2,"0"); }
    function inRange(s,e,n){ return s<=e ? n>=s&&n<e : n>=s||n<e; }

    function configurarVista(){
        const now = new Date();
        const h = now.getHours();
        const m = now.getMinutes();
        const nowMin = h*60+m;

        const map = document.getElementById("map-section");
        const cochera = document.getElementById("cochera-section");
        const banner = document.getElementById("turno-banner");
        const text = document.getElementById("turno-text");
        const bg = document.getElementById("turno-bg");

        const pausa = inRange(13*60,14*60,nowMin);
        const noche = inRange(21*60+30,5*60,nowMin);
        const horaTxt = `${two(h)}:${two(m)}`;

        if(pausa || noche){
            map.classList.add("hidden");
            cochera.classList.remove("hidden");
            banner.classList.add("hidden");
            return;
        }

        cochera.classList.add("hidden");
        map.classList.remove("hidden");
        banner.classList.remove("hidden");

        if(h>=5 && h<13){
            text.textContent = `ðŸŸ¢ TURNO MAÃ‘ANA ACTIVO Â· ${horaTxt}`;
            bg.className = "w-full rounded-xl px-6 py-3 text-white text-center font-semibold shadow-lg bg-gradient-to-r from-green-600 to-emerald-500";
        } else {
            text.textContent = `ðŸ”µ TURNO TARDE ACTIVO Â· ${horaTxt}`;
            bg.className = "w-full rounded-xl px-6 py-3 text-white text-center font-semibold shadow-lg bg-gradient-to-r from-blue-600 to-cyan-500";
        }
    }

    window.addEventListener("load", configurarVista);
    setInterval(configurarVista, 20000);
</script>

</body>
</html>
